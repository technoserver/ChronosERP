<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="./WEB-INF/layout/layoutPadrao.xhtml"
                xmlns:h="http://java.sun.com/jsf/html">

    <ui:define name="css">
        <h:outputStylesheet library="css" name="vendor/c3.min.css"/>
        <style type="text/css">
            #dock-container {
                position: fixed;
                bottom: 46px;
                text-align: center;
                right: 20%;
                left: 20%;
                width: 60%;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 10px 10px 0 0;
            }

            #dock-container li {
                list-style-type: none;
                display: inline-block;
                position: relative;
            }

            #dock-container li img {
                width: 64px;
                height: 64px;
                -webkit-box-reflect: below 2px -webkit-gradient(linear, left top, left bottom, from(transparent),
                color-stop(0.7, transparent), to(rgba(255, 255, 255, .5))); /* reflection is supported by webkit only */
                -webkit-transition: all 0.3s;
                -webkit-transform-origin: 50% 100%;
            }

            #dock-container li:hover img {
                -webkit-transform: scale(2);
                margin: 0 2em;
            }

            #dock-container li:hover + li img,
            #dock-container li.prev img {
                -webkit-transform: scale(1.5);
                margin: 0 1.5em;
            }

            #dock-container li span {
                display: none;
                position: absolute;
                bottom: 140px;
                left: 0;
                width: 100%;
                background-color: rgba(0, 0, 0, 0.75);
                padding: 4px 0;
                border-radius: 12px;
            }

            #dock-container li:hover span {
                display: block;
                color: #fff;
            }

            .box {
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid #eeeeee;
                border-bottom: 3px solid #1ab394;
                background: #ffffff;
            }

            .box__icon {
                float: left;
                color: #1ab394;
            }

            .box__value {
                font-size: 1.69em;
                font-weight: 300;
                text-align: right;
            }

            .box__title {
                display: block;
                font-size: 1em;
                font-weight: 600;
                text-align: right;
            }

            .not-show {
                display: none;
            }

        </style>
    </ui:define>
    <ui:define name="title">
        Home
    </ui:define>
    <ui:define name="controle">
        Dashboard
    </ui:define>
    <ui:define name="tela">
       <span style="color: red;">
          <h1> Sistema rodando em Teste caso esteja vendo essa tela entrar em contato com o suporte.</h1>
       </span>
    </ui:define>


    <ui:define name="telaVazia">
        <h:inputHidden id="reusumoContas" value="#{homeControll.jsonResumoContas}"/>
        <div class="row">
            <div class="col-md-12">
                <div class="ibox">
                    <div class="ibox-content">
                        <h3 class="text-warning margin-top-0 padding-left-15px padding-right-15px">
                            <i class="fa fa-cogs margin-right-5px "></i>
                            Configurações
                        </h3>
                        <div class="row">
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/configuracoes/parametros" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-cogs text-primary"></i>Parâmentros
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">

                                <h:link outcome="/modulo/configuracoes/certificado" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa icon-certificatethree text-primary"></i>Certificado
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/configuracoes/nfeConfiguracao" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-file-text-o text-primary"></i>NF-e
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">

                                <h:link outcome="/modulo/configuracoes/pdvConfiguracao" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-shopping-cart text-primary"></i>PDV
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">

                                <h:link outcome="/modulo/configuracoes/mdfeConfiguracao" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa  fa-paper-plane text-primary"></i>MDF-e
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">

                                <h:link outcome="/modulo/configuracoes/notaFiscalTipo" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-list-alt text-primary"></i>Documentos Fiscais
                                </h:link>
                            </div>

                        </div>
                        <h3 class="text-primary margin-top-0 padding-left-15px padding-right-15px"><i
                                class="fa fa-hand-o-right margin-right-5px "></i>Acesso rápido</h3>
                        <div class="row">
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/comercial/vendas/balcao"
                                        class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-shopping-cart text-primary"></i>PDV
                                </h:link>

                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/comercial/os/osAbertura"
                                        class="btn btn-app" style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-files-o text-primary"></i>OS
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/comercial/nfe/nfe"
                                        class="btn btn-app" style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-file-text-o text-primary"></i>
                                    NF-e
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/cadastros/comercial/cliente"
                                        class="btn btn-app" style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-user-circle-o text-primary"></i>Clientes
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/cadastros/comercial/fornecedor"
                                        class="btn btn-app" style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-truck text-primary"></i>Fornecedores
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/cadastros/pessoal/colaborador/colaborador"
                                        class="btn btn-app" style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-handshake-o text-primary"></i>Colaborador
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/cadastros/pessoal/pessoa" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-users text-primary"></i>Pessoas
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/cadastros/produto/produtos" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-cubes"></i>Produtos
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/financeiro/pagamento/finPagamento"
                                        class="btn btn-app" style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-money text-primary"></i>Contas a pagar
                                </h:link>
                            </div>
                            <div class="col-xs-6 col-sm-4 col-md-2">
                                <h:link outcome="/modulo/financeiro/recebimento/finRecebimento" class="btn btn-app"
                                        style="width: 100%;margin-top: 5px">
                                    <i class="fa fa-money text-primary"></i>Contas a Receber
                                </h:link>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>


        <h:panelGroup layout="block" styleClass="row" rendered="#{seguranca.isTemAcesso('VENDA')}">

            <div class="col-xs-12 col-md-4">
                <div class="box">
                    <div class="box__icon">
                        <i class="fa  fa-signal  fa-3x"></i>
                    </div>
                    <div class="box__value">
                        <h:outputText value="#{homeControll.valorTotalVendaNoMes}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </div>
                    <div class="box__title">Pedidos de Venda no mês</div>
                </div>
            </div>

            <div class="col-xs-12 col-md-4">
                <div class="box">
                    <div class="box__icon">
                        <i class="fa  fa-usd  fa-3x"></i>
                    </div>
                    <div class="box__value">
                        <h:outputText value="#{homeControll.valorTotalVendaNoAno}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </div>
                    <div class="box__title">Pedidos Venda no ano</div>
                </div>
            </div>


            <div class="col-xs-12 col-md-4">
                <div class="box">
                    <div class="box__icon">
                        <i class="fa  fa-shopping-cart  fa-3x"></i>
                    </div>
                    <div class="box__value">
                        <h:outputText value="#{homeControll.valorVendaMedioNoAno}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </div>
                    <div class="box__title">Pedidos de Venda em média</div>
                </div>
            </div>

        </h:panelGroup>


        <h:panelGroup layout="block" styleClass="row"
                      rendered="#{seguranca.financeiro and seguranca.isTemAcesso('RECEBIMENTO') and seguranca.isTemAcesso('PAGAMENTO')}">
            <div class="col-md-4">
                <div class="ibox">
                    <div class="ibox-content">
                        <h4 style="font-weight: bold;margin-bottom: 20px">Contas a Pagar/Receber pagas no mês</h4>
                        <div id="chartResumo"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="ibox">
                    <div class="ibox-content">
                        <h4 style="font-weight: bold;margin-bottom: 20px">Contas a Pagar/Receber vencidas no mês</h4>

                        <div id="chartResumo2"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="ibox">
                    <div class="ibox-content">
                        <h4 style="font-weight: bold;margin-bottom: 20px">Contas a Pagar/Rec. a vencer com 7 dias</h4>

                        <div id="chartResumo3"></div>
                    </div>
                </div>
            </div>
        </h:panelGroup>

        <div class="row">
            <div class="col-md-12">
                <div class="ibox">
                    <div class="ibox-content">
                        <h3 style="font-weight: bold;margin-bottom: 20px">Compromissos</h3>
                        <p:dataTable id="dataTableCompromisso" var="obj"
                                     value="#{homeControll.compromissos}"
                                     paginator="true" rows="10" rowsPerPageTemplate="10,20,30,40"
                                     resizableColumns="true" paginatorPosition="bottom">


                            <p:column headerText="Data" width="100">
                                <h:outputLabel value="#{obj.dataCompromisso}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputLabel>
                            </p:column>
                            <p:column headerText="Hora" width="80">
                                <h:outputLabel value="#{obj.hora}"/>
                            </p:column>
                            <p:column headerText="Descrição">
                                <h:outputLabel value="#{obj.descricao}"/>
                            </p:column>
                            <p:column headerText="Local">
                                <h:outputLabel value="#{obj.onde}"/>
                            </p:column>

                        </p:dataTable>
                    </div>
                </div>
            </div>
        </div>

    </ui:define>


    <ui:define name="outrasTelas">
        <h:form id="formOutrasTelas">
            <p:dialog id="dialogOutrasTela" header="Avisos" responsive="true"
                      widgetVar="dialogOutrasTela" showEffect="slide" hideEffect="slide" width="500"
                      resizable="true" modal="true" closable="false" visible="#{homeControll.possueAviso}">
                <p:outputPanel id="panelOutrasTela">
                    <div class="row">
                        <div class="col-xs-12">


                            <ui:repeat value="#{homeControll.avisos}" var="row" id="laco">

                                <p:panelGrid columns="2" layout="grid" id="gridAviso">
                                    <p:commandLink style="float:left;margin-right:10px"
                                                   action="#{homeControll.confirmarAviso}"
                                                   id="btnConfirmarAviso"
                                                   update="formOutrasTelas:dialogOutrasTela">
                                        <i class="fa fa-check"></i>
                                        <f:setPropertyActionListener value="#{row}"
                                                                     target="#{homeControll.avisoConfirmado}"/>
                                    </p:commandLink>
                                    <h:outputText value=" #{row.aviso}" style="display:inline-block"/>

                                </p:panelGrid>
                            </ui:repeat>


                        </div>
                    </div>
                </p:outputPanel>
                <f:facet name="footer">
                    <div class="row">
                        <div class="col-xs-12 text-center">
                            <p:commandButton value="Fechar"
                                             oncomplete="PF('dialogOutrasTela').hide();" process="@this"/>
                        </div>
                    </div>

                </f:facet>
            </p:dialog>
        </h:form>
    </ui:define>

    <ui:define name="javaScript">
        <h:outputScript library="js" name="vendor/c3charts/d3.min.js"/>
        <h:outputScript library="js" name="vendor/c3charts/c3.min.js"/>
        <script type="application/javascript">

            var local = d3.locale({
                "decimal": ",",
                "thousands": ".",
                "grouping": [3],
                "currency": ["R$", ""],
                "dateTime": "%d/%m/%Y %H:%M:%S",
                "date": "%d/%m/%Y",
                "time": "%H:%M:%S",
                "periods": ["AM", "PM"],
                "days": ["Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado"],
                "shortDays": ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"],
                "months": ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"],
                "shortMonths": ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"]
            });
            var formatter = local.numberFormat;

            $(document).ready(function () {
                gerarGrafico();
            });

            function gerarGrafico() {
                var resumoContas = $(PrimeFaces.escapeClientId('formCentro:reusumoContas')).val();
                var jsonResumoContas;
                if (resumoContas) {
                    jsonResumoContas = $.parseJSON(resumoContas);

                    var quitadas = [];
                    var vencidas = [];
                    var avencer = [];


                    jsonResumoContas.forEach(function (e) {

                        var quitada;
                        var vencida;
                        var vencer;
                        if (e.viewResumoContas.tipo === 'P') {

                            quitada = {"descricao": "DESPESAS", Despesa: e.viewResumoContas.valorQuitado};
                            vencida = {"descricao": "DESPESAS", Despesa: e.viewResumoContas.totalQuita};
                            vencer = {"descricao": "DESPESAS", Despesa: e.viewResumoContas.totalQuita7Dias};
                        } else {

                            quitada = {"descricao": "RECEITAS", Receita: e.viewResumoContas.valorQuitado};
                            vencida = {"descricao": "RECEITAS", Receita: e.viewResumoContas.totalQuita};
                            vencer = {"descricao": "RECEITAS", Receita: e.viewResumoContas.totalQuita7Dias};
                        }
                        quitadas.push(quitada);
                        vencidas.push(vencida);
                        avencer.push(vencer);
                    });
                    montarGraficoContas(quitadas, ["Despesa", "Receita"], '#chartResumo');
                    montarGraficoContas(vencidas, ["Despesa", "Receita"], '#chartResumo2');
                    montarGraficoContas(avencer, ["Despesa", "Receita"], '#chartResumo3');
                }

            }

            function montarGraficoContas(valores, valueKey, grafico) {


                chart = c3.generate({
                    padding: {
                        top: 10

                    },
                    bindto: grafico,
                    data: {
                        json: valores,
                        keys: {
                            x: 'descricao',
                            value: valueKey,
                        },
                        type: 'bar'
                    },
                    axis: {
                        x: {
                            type: 'category'
                        },
                        y: {tick: {count: 10, format: formatter(',.2f')}}
                    },
                    bar: {
                        width: {
                            ratio: 0.5
                        }
                    }
                });

            }

        </script>


    </ui:define>

</ui:composition>
