<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml"
                template="/WEB-INF/layout/layoutPadrao.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:erp="http://java.sun.com/jsf/composite/components"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="title">
        #{vendaOrcamentoCabecalhoControll.tipo eq 'O'?'Orçamento':'PEDIDO'}
    </ui:define>

    <ui:define name="tela">
        #{vendaOrcamentoCabecalhoControll.titulo}
    </ui:define>
    <ui:define name="controle">
        #{vendaOrcamentoCabecalhoControll.tipo eq 'O'?'Orçamento':'PEDIDO'}
    </ui:define>


    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="tipo" value="#{vendaOrcamentoCabecalhoControll.tipo}"/>
        </f:metadata>
    </ui:define>
    <ui:define name="gridDados">

        <erp:gridDados controller="#{vendaOrcamentoCabecalhoControll}"
                       idDataTable="dataTableVendaOrcamentoCabecalho"
                       nomeFuncao="Orçamento"
                       id="telaGrid"
        >

            <p:column headerText="Cliente">
                <h:outputLabel value="#{row.cliente.pessoa.nome}"/>
            </p:column>
            <p:column headerText="Vendedor">
                <h:outputLabel value="#{row.vendedor.colaborador.pessoa.nome}"/>
            </p:column>
            <p:column headerText="Tipo">
                <h:outputLabel
                        value="#{vendaOrcamentoCabecalhoControll.keyFromValue(vendaOrcamentoCabecalhoControll.vendaOrcamentoTipo, obj.tipo)}"/>
            </p:column>
            <p:column headerText="Codigo">
                <h:outputLabel value="#{row.codigo}"/>
            </p:column>
            <p:column headerText="Validade">
                <h:outputLabel value="#{row.validade}">
                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                </h:outputLabel>
            </p:column>
            <p:column headerText="Valor Total">
                <h:outputLabel value="#{row.valorTotal}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputLabel>
            </p:column>


        </erp:gridDados>
    </ui:define>


    <ui:define name="telaInclusaoAlteracao">
        <erp:telaInclusaoAlteracao controller="#{vendaOrcamentoCabecalhoControll}"
                                   nomeFuncao="Orçamento"
                                   id="telaDetalhe"
        >

            <div class="row">
                <div class="col-lg-4 col-xs-6">
                    <!-- small box -->
                    <div class="small-box bg-gray">
                        <div class="inner">
                            <h3>R$<span>#{vendaOrcamentoCabecalhoControll.objeto.valorTotalFormatado()}</span></h3>

                            <p>Valor Total</p>
                        </div>
                        <div class="icon" style="top: 0px">
                            <i class="fa  fa-money"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-xs-6">
                    <!-- small box -->
                    <div class="small-box bg-gray">
                        <div class="inner">
                            <h3>R$<span>#{vendaOrcamentoCabecalhoControll.objeto.valorSubTotalFormatado()}</span></h3>

                            <p>Valor Produtos</p>
                        </div>
                        <div class="icon" style="top: 0px">
                            <i class="fa fa-shopping-cart"></i>
                        </div>
                    </div>
                </div>


                <div class="col-lg-4 col-xs-6">
                    <!-- small box -->
                    <div class="small-box bg-gray">
                        <div class="inner">
                            <h3>R$<span>#{vendaOrcamentoCabecalhoControll.objeto.valorDescontoFormatado()}</span>
                            </h3>

                            <p>Valor do Desconto</p>
                        </div>
                        <div class="icon" style="top: 0px">
                            <i class="fa fa-percent" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <erp:autoComplete styleClass="col-xs-12 col-sm-4 col-md-4"
                                  label="Cliente"
                                  itemLabel="#{objeto.pessoa.nome}"
                                  controller="#{vendaOrcamentoCabecalhoControll}"
                                  completeMethod="getListaCliente"
                                  nomeAtributo="#{vendaOrcamentoCabecalhoControll.objeto.cliente}"
                                  idComponente="vendaOrcamentoCabecalhoCliente"/>
                <erp:autoComplete styleClass="col-xs-12 col-sm-4 col-md-4"
                                  label="Vendedor"
                                  itemLabel="#{objeto.colaborador.pessoa.nome}"
                                  controller="#{vendaOrcamentoCabecalhoControll}"
                                  completeMethod="getListaVendedor"
                                  nomeAtributo="#{vendaOrcamentoCabecalhoControll.objeto.vendedor}"
                                  idComponente="vendaOrcamentoCabecalhoVendedor">
                    <p:ajax event="itemSelecionado"
                            listener="#{vendaOrcamentoCabecalhoControll.definirTaxaComissao}"
                    />
                </erp:autoComplete>

                <erp:autoComplete styleClass="col-xs-12 col-sm-4 col-md-4"
                                  label="Condicoes Pagamento"
                                  itemLabel="#{objeto.nome}"
                                  controller="#{vendaOrcamentoCabecalhoControll}"
                                  completeMethod="getListaVendaCondicoesPagamento"
                                  nomeAtributo="#{vendaOrcamentoCabecalhoControll.objeto.condicoesPagamento}"
                                  idComponente="vendaOrcamentoCabecalhoVendaCondicoesPagamento"/>


            </div>
            <div class="row">
                <erp:campoAreaTexto styleClass="col-xs-12 col-sm-12 col-md-12"
                                    idComponente="vendaOrcamentoCabecalhoObservacao"
                                    label="Observacao"
                                    nomeAtributo="#{vendaOrcamentoCabecalhoControll.objeto.observacao}"/>
            </div>
            <erp:separador label="Produtos"/>
            <div class="row">
                <div class="col-md-12">
                    <h:commandLink title="Novo" class="btn btn-default"
                                   actionListener="#{vendaOrcamentoCabecalhoControll.incluirVendaOrcamentoDetalhe}"
                                   type="button"
                                   rendered="#{not empty vendaOrcamentoCabecalhoControll.objeto.id}">
                        <i class="glyphicon glyphicon-plus"/>
                        <p:ajax update=":formOutrasTelas:panelVendaOrcamentoDetalhe,dataTableVendaOrcamentoDetalhe"
                                oncomplete="PF('dialogVendaOrcamentoDetalhe').show()"
                                process="@this,dataTableVendaOrcamentoDetalhe"/>
                    </h:commandLink>
                </div>
            </div>
            <p:dataTable id="dataTableVendaOrcamentoDetalhe" var="obj"
                         value="#{vendaOrcamentoCabecalhoControll.objeto.listaVendaOrcamentoDetalhe}"
                         paginator="true" rows="10" rowsPerPageTemplate="10,20,30,40"
                         resizableColumns="true" reflow="true"
                         rowKey="#{obj.id}" paginatorPosition="bottom">


                <p:column headerText="Produto">
                    <h:outputLabel value="#{obj.produto.nome}"/>
                </p:column>
                <p:column headerText="Quantidade">
                    <h:outputLabel value="#{obj.quantidade}">
                        <f:convertNumber pattern="0.000"/>
                    </h:outputLabel>
                </p:column>
                <p:column headerText="Valor Unitario">
                    <h:outputLabel value="#{obj.valorUnitario}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputLabel>
                </p:column>
                <p:column headerText="Valor Subtotal">
                    <h:outputLabel value="#{obj.valorSubtotal}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputLabel>
                </p:column>
                <p:column headerText="Taxa Desconto">
                    <h:outputLabel value="#{obj.taxaDesconto}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputLabel>
                </p:column>
                <p:column headerText="Valor Desconto">
                    <h:outputLabel value="#{obj.valorDesconto}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputLabel>
                </p:column>
                <p:column headerText="Valor Total">
                    <h:outputLabel value="#{obj.valorTotal}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputLabel>
                </p:column>
                <p:column headerText="Ações" width="110">
                    <p:commandLink title="Alterar"
                                   process="dataTableVendaOrcamentoDetalhe"
                                   action="#{vendaOrcamentoCabecalhoControll.alterarVendaOrcamentoDetalhe}"
                                   class=" btn btn-default"
                                   oncomplete="PF('dialogVendaOrcamentoDetalhe').show()"
                                   update=":formOutrasTelas:panelVendaOrcamentoDetalhe,dataTableVendaOrcamentoDetalhe"
                    >
                        <i class="fa fa-file-text-o"></i>
                        <f:setPropertyActionListener value="#{obj}"
                                                     target="#{vendaOrcamentoCabecalhoControll.vendaOrcamentoDetalheSelecionado}"/>
                    </p:commandLink>
                    &nbsp;
                    <p:commandLink title="Excluir"
                                   action="#{vendaOrcamentoCabecalhoControll.excluirVendaOrcamentoDetalhe}"
                                   style="position: relative; right: 7px"
                                   update=":formCentro:growl,dataTableVendaOrcamentoDetalhe,:formCentro:telaDetalhe:outputPanelDetalhe"
                                   process="dataTableVendaOrcamentoDetalhe"
                                   oncomplete="atualizarMsg();"
                                   class="btn btn-default"
                    >
                        <i class="fa fa-times"></i>
                        <p:confirm header="Confirmar" message="Deseja excluir ?"/>

                        <f:setPropertyActionListener value="#{obj}"
                                                     target="#{vendaOrcamentoCabecalhoControll.vendaOrcamentoDetalheSelecionado}"/>
                    </p:commandLink>
                </p:column>


            </p:dataTable>


        </erp:telaInclusaoAlteracao>
    </ui:define>

    <ui:define name="outrasTelas">
        <h:form id="formOutrasTelas">

            <p:dialog id="dialogVendaOrcamentoDetalhe" responsive="true"
                      header="Inclusão/Alteração Venda Orcamento Detalhe"
                      widgetVar="dialogVendaOrcamentoDetalhe" showEffect="slide"
                      hideEffect="slide" resizable="true" modal="true" closable="false"
                      width="800">

                <p:outputPanel id="panelVendaOrcamentoDetalhe">
                    <div class="row">
                        <erp:autoComplete styleClass="col-xs-12 col-sm-6 col-md-6"
                                          label="Produto"
                                          itemLabel="#{objeto.nome}"
                                          controller="#{vendaOrcamentoCabecalhoControll}"
                                          completeMethod="getListaProduto"
                                          nomeAtributo="#{vendaOrcamentoCabecalhoControll.vendaOrcamentoDetalhe.produto}"
                                          idComponente="vendaOrcamentoDetalheProduto"/>
                        <erp:campoDecimal styleClass="col-xs-12 col-sm-3 col-md-3"
                                          idComponente="vendaOrcamentoDetalheQuantidade" label="Quantidade"
                                          requerido="true"
                                          nomeAtributo="#{vendaOrcamentoCabecalhoControll.vendaOrcamentoDetalhe.quantidade}"/>
                        <erp:campoDecimal styleClass="col-xs-12 col-sm-3 col-md-3"
                                          idComponente="vendaOrcamentoDetalheTaxaDesconto"
                                          label="Taxa Desconto"
                                          nomeAtributo="#{vendaOrcamentoCabecalhoControll.vendaOrcamentoDetalhe.taxaDesconto}"/>
                    </div>


                </p:outputPanel>
                <f:facet name="footer">
                    <p:commandButton value="Salvar"
                                     actionListener="#{vendaOrcamentoCabecalhoControll.salvarVendaOrcamentoDetalhe}"
                                     update=":formOutrasTelas:panelVendaOrcamentoDetalhe,:formCentro:growl,:formCentro:telaDetalhe:outputPanelDetalhe"
                                     oncomplete="if (!args.validationFailed) {PF('dialogVendaOrcamentoDetalhe').hide();}"/>
                    <p:commandButton value="Cancelar"
                                     oncomplete="PF('dialogVendaOrcamentoDetalhe').hide();"/>
                </f:facet>

            </p:dialog>
        </h:form>
    </ui:define>

</ui:composition>
